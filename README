# â™” Chess App - AplicaciÃ³n de Ajedrez Mejorada â™š

AplicaciÃ³n web de ajedrez con autenticaciÃ³n, IA funcional, reglas completas de ajedrez, y estadÃ­sticas. Backend Node.js + Express, Frontend Vanilla JS, Base de datos PostgreSQL.

## âœ¨ CaracterÃ­sticas Completas

### ğŸ® Juego de Ajedrez
- âœ… Todas las reglas oficiales de ajedrez implementadas
- âœ… Jaque y jaque mate detectados correctamente
- âœ… Enroque (kingside y queenside)
- âœ… En passant (captura al paso)
- âœ… PromociÃ³n de peones automÃ¡tica
- âœ… DetecciÃ³n de ahogado (stalemate)
- âœ… Tablero interactivo con resaltado de movimientos vÃ¡lidos

### ğŸ¤– Inteligencia Artificial
- âœ… IA funcional con evaluaciÃ³n de posiciones
- âœ… Prioriza capturas y control del centro
- âœ… Detecta jaque mate y ahogado
- âœ… Indicador visual de "pensando"

### ğŸ” Seguridad
- âœ… AutenticaciÃ³n JWT con expiraciÃ³n de 7 dÃ­as
- âœ… ContraseÃ±as hasheadas con bcrypt (10 rounds)
- âœ… ValidaciÃ³n de entrada robusta
- âœ… Rate limiting (100 req/15min)
- âœ… CORS configurado por entorno
- âœ… SanitizaciÃ³n de datos
- âœ… ProtecciÃ³n contra SQL injection

### ğŸ“Š EstadÃ­sticas y Historial
- âœ… Historial de las Ãºltimas 20 partidas
- âœ… EstadÃ­sticas: victorias blancas/negras, empates, promedio de movimientos
- âœ… Guardado automÃ¡tico en la nube

### ğŸ¨ Interfaz
- âœ… DiseÃ±o moderno con efectos de estrellas
- âœ… Responsive (mÃ³vil, tablet, desktop)
- âœ… Animaciones suaves
- âœ… Indicador de jaque en tiempo real
- âœ… Contador de piezas capturadas

## ğŸ”§ Correcciones Implementadas

### âŒ Errores CrÃ­ticos Resueltos:

1. **âœ… IA Funcional**: Implementada completamente con evaluaciÃ³n de tablero y algoritmo de selecciÃ³n de movimientos
2. **âœ… API URL Adaptativa**: Detecta automÃ¡ticamente localhost vs producciÃ³n
3. **âœ… Reglas de Ajedrez Completas**: Jaque, jaque mate, enroque, en passant, promociÃ³n
4. **âœ… Manejo Robusto de Errores**: Todas las llamadas HTTP usan `safeFetch()` con manejo de JSON/texto

### ğŸ›¡ï¸ Mejoras de Seguridad:

- âœ… JWT_SECRET obligatorio (servidor no inicia sin Ã©l)
- âœ… ValidaciÃ³n de email, username y password
- âœ… CORS restrictivo en producciÃ³n
- âœ… Rate limiting implementado
- âœ… ValidaciÃ³n de movimientos en servidor
- âœ… Constraints de base de datos

## ğŸ“‹ InstalaciÃ³n

### 1. Requisitos Previos
- Node.js v14 o superior
- npm o yarn
- Cuenta en [Neon](https://neon.tech) (PostgreSQL gratuito)

### 2. Clonar e Instalar
```bash
# Instalar dependencias
npm install
```

### 3. Configurar Variables de Entorno

Crea un archivo `.env` en la raÃ­z del proyecto:

```env
DATABASE_URL=postgresql://usuario:contraseÃ±a@ep-nombre.region.neon.tech/chessapp?sslmode=require
JWT_SECRET=genera-una-clave-segura-aqui
PORT=3000
NODE_ENV=development
```

**Generar JWT_SECRET seguro:**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### 4. Iniciar el Servidor

**Desarrollo:**
```bash
npm run dev
```

**ProducciÃ³n:**
```bash
npm start
```

### 5. Abrir en el Navegador
```
http://localhost:3000
```

## ğŸ® CÃ³mo Jugar

### Primera Vez
1. Haz clic en "RegÃ­strate aquÃ­"
2. Ingresa usuario, email y contraseÃ±a (mÃ­n. 6 caracteres)
3. Â¡Listo para jugar!

### Modo VS IA
1. Selecciona "VS Computadora"
2. Juegas con piezas blancas
3. La IA mueve automÃ¡ticamente las negras

### Modo VS Jugador
1. Selecciona "VS Jugador"
2. Turnos alternados en el mismo dispositivo

### Reglas del Juego
- Haz clic en una pieza para seleccionarla
- Las casillas amarillas muestran movimientos vÃ¡lidos
- No puedes mover si dejas a tu rey en jaque
- Gana capturando el rey o haciendo jaque mate
- Empate por ahogado si no hay movimientos legales

## ğŸ“ Estructura del Proyecto

```
chess-app/
â”œâ”€â”€ index.html              # Interfaz HTML
â”œâ”€â”€ styles.css              # Estilos CSS
â”œâ”€â”€ script.js               # LÃ³gica del cliente (MEJORADO)
â”œâ”€â”€ server.js               # Servidor Express (MEJORADO)
â”œâ”€â”€ package.json            # Dependencias
â”œâ”€â”€ .env                    # Variables de entorno (NO SUBIR A GIT)
â”œâ”€â”€ .env.example            # Ejemplo de .env
â”œâ”€â”€ .gitignore              # Archivos ignorados por Git
â””â”€â”€ README.md               # Este archivo
```

## ğŸ“Š API Endpoints

### AutenticaciÃ³n
- `POST /api/register` - Registrar usuario
- `POST /api/login` - Iniciar sesiÃ³n
- `GET /api/verify` - Verificar token

### Juego
- `POST /api/games` - Guardar partida
- `GET /api/games` - Obtener historial (Ãºltimas 20)
- `GET /api/stats` - Obtener estadÃ­sticas

### Health Check
- `GET /health` - Estado del servidor

## ğŸ› ï¸ TecnologÃ­as

| CategorÃ­a | TecnologÃ­a |
|-----------|-----------|
| **Frontend** | HTML5, CSS3, JavaScript (Vanilla) |
| **Backend** | Node.js, Express.js |
| **Base de Datos** | PostgreSQL (Neon) |
| **AutenticaciÃ³n** | JWT, bcrypt |
| **Otros** | CORS, dotenv, pg (node-postgres) |

## ğŸ”’ Seguridad Implementada

- âœ… ContraseÃ±as hasheadas con bcrypt (salt rounds: 10)
- âœ… JWT con expiraciÃ³n de 7 dÃ­as
- âœ… ValidaciÃ³n de email (regex)
- âœ… ValidaciÃ³n de username (3-20 caracteres alfanumÃ©ricos)
- âœ… ValidaciÃ³n de password (6-100 caracteres)
- âœ… SanitizaciÃ³n de inputs
- âœ… Rate limiting (100 req / 15 min)
- âœ… CORS restrictivo en producciÃ³n
- âœ… ConexiÃ³n SSL a base de datos
- âœ… ValidaciÃ³n de movimientos en servidor
- âœ… Constraints de base de datos (CHECK, UNIQUE)

## ğŸ› SoluciÃ³n de Problemas

### Error: "JWT_SECRET no configurado"
**SoluciÃ³n:** Crea un archivo `.env` con `JWT_SECRET=tu-clave-segura`

### Error de conexiÃ³n a la base de datos
**SoluciÃ³n:** 
1. Verifica que `DATABASE_URL` estÃ© correcto
2. AsegÃºrate de que tu IP estÃ© permitida en Neon
3. Verifica que la base de datos exista

### Error "Cannot GET /"
**SoluciÃ³n:**
1. Verifica que `index.html` estÃ© en la carpeta correcta
2. Reinicia el servidor: `npm start`

### Token invÃ¡lido
**SoluciÃ³n:** Cierra sesiÃ³n y vuelve a iniciar sesiÃ³n (tokens expiran en 7 dÃ­as)

### IA no mueve
**SoluciÃ³n:** Esta versiÃ³n tiene la IA completamente funcional. Si no mueve:
1. Verifica la consola del navegador (F12)
2. AsegÃºrate de que no haya errores JavaScript

## ğŸš€ Despliegue en ProducciÃ³n

### Variables de Entorno Requeridas
```env
DATABASE_URL=postgresql://...
JWT_SECRET=clave-super-segura-32-caracteres-minimo
NODE_ENV=production
ALLOWED_ORIGIN=https://tu-dominio.com
PORT=3000
```

### Plataformas Recomendadas
- **Backend**: Railway, Render, Heroku
- **Base de Datos**: Neon (gratis), Supabase, Railway
- **Frontend**: Vercel, Netlify (si separas frontend)

### Checklist de ProducciÃ³n
- [ ] JWT_SECRET Ãºnico y seguro (32+ caracteres)
- [ ] DATABASE_URL apunta a DB de producciÃ³n
- [ ] NODE_ENV=production
- [ ] ALLOWED_ORIGIN configurado
- [ ] SSL habilitado
- [ ] Logs configurados
- [ ] Backups de BD configurados

## ğŸ“ Notas TÃ©cnicas

### Reglas Implementadas
- âœ… Movimientos bÃ¡sicos de todas las piezas
- âœ… Jaque y jaque mate
- âœ… Enroque (si rey y torre no han movido, no hay piezas en medio, rey no pasa por jaque)
- âœ… En passant (captura al paso de peÃ³n)
- âœ… PromociÃ³n de peones (automÃ¡tica a reina)
- âœ… Ahogado (stalemate)

### Limitaciones Conocidas
- âš ï¸ PromociÃ³n solo a reina (no permite elegir pieza)
- âš ï¸ IA de 1 nivel de profundidad (no usa minimax completo)
- âš ï¸ Sin detecciÃ³n de tablas por repeticiÃ³n de posiciones
- âš ï¸ Sin regla de 50 movimientos

### PrÃ³ximas Mejoras Sugeridas
- ğŸ”œ Selector de pieza en promociÃ³n de peÃ³n
- ğŸ”œ IA con minimax de mayor profundidad
- ğŸ”œ NotaciÃ³n PGN completa
- ğŸ”œ Temporizador de partida
- ğŸ”œ Modo multijugador online (WebSockets)
- ğŸ”œ AnÃ¡lisis de partida con Stockfish

## ğŸ“„ Licencia

ISC

## ğŸ‘¨â€ğŸ’» Changelog

### v2.0.0 - VersiÃ³n Mejorada (2024)
- âœ… IA completamente funcional
- âœ… Reglas completas de ajedrez (jaque mate, enroque, en passant)
- âœ… API URL adaptativa (desarrollo/producciÃ³n)
- âœ… Manejo robusto de errores HTTP
- âœ… ValidaciÃ³n de entrada mejorada
- âœ… Rate limiting implementado
- âœ… CORS configurado por entorno
- âœ… Seguridad reforzada

### v1.0.0 - VersiÃ³n Original
- âœ… Sistema de autenticaciÃ³n
- âœ… Tablero interactivo
- âœ… ValidaciÃ³n bÃ¡sica de movimientos
- âš ï¸ IA no funcional
- âš ï¸ Reglas incompletas

---

**Â¿Preguntas o problemas?** Abre un issue en GitHub o contacta al desarrollador.

**Â¡Disfruta jugando ajedrez! â™Ÿï¸**